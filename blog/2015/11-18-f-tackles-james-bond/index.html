
<!doctype html>
<!--[if IE 9]><html class="lt-ie10" lang="en" > <![endif]-->
<html class="no-js" lang="en" data-useragent="Mozilla/5.0 (compatible; MSIE 10.0; Windows NT 6.2; Trident/6.0)">
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="chrome=1">
    <title>F# tackles James Bond</title>
    <meta name="description" content="Earlier this week I read an interesting blog post on visualizing box office success of individual James Bond films using R and ggplot2. In this blog post I'm looking at how to do similar analysis in F#, using the HTML type provider and XPlot." />
    <meta name="author" content="Evelina Gabasova" />
    <meta name="copyright" content="Evelina Gabasova 2014" />

    <!-- Twitter cards -->
    <meta name="twitter:card" content="summary">
    <meta name="twitter:creator" content="@evelgab">
    <meta name="twitter:title" content="F# tackles James Bond">
    <meta name="twitter:description" content="Earlier this week I read an interesting blog post on visualizing box office success of individual James Bond films using R and ggplot2. In this blog post I'm looking at how to do similar analysis in F#, using the HTML type provider and XPlot.">
        <meta name="twitter:image" content="http://evelinag.com/blog/2015/11-18-f-tackles-james-bond/bond-bubble.png">
    <!-- End Twitter cards -->

    <link rel="stylesheet" href="http://evelinag.com/stylesheets/foundation.min.css">
    <link rel="stylesheet" href="http://evelinag.com/stylesheets/fontsStylesheet.css">
    <link rel="stylesheet" href="http://evelinag.com/stylesheets/personalStyles.css">
    <link rel="stylesheet" href="http://evelinag.com/stylesheets/pygment_trac.css">

    <link rel="shortcut icon" href="http://evelinag.com/favicon.png">
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />

    <link rel="alternate" type="application/rss+xml" title="Evelina Gabasova's blog" href="http://evelinag.com/rss.xml" />

    <!--[if lt IE 9]>
    <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <!-- FSharp.Formatting Styles -->
    <link rel="stylesheet" type="text/css" media="screen" href="http://evelinag.com/fsharp.formatting/tooltips.css" />
    <script type="text/javascript" src="http://evelinag.com/fsharp.formatting/tooltips.js"></script>
    <script type="text/javascript" src="http://evelinag.com/javascripts/modernizr.js"></script>
    <script type="text/javascript" src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>

    <!-- Google Analytics -->
    <script>
        (function (i, s, o, g, r, a, m) {
            i['GoogleAnalyticsObject'] = r; i[r] = i[r] || function () {
                (i[r].q = i[r].q || []).push(arguments)
            }, i[r].l = 1 * new Date(); a = s.createElement(o),
            m = s.getElementsByTagName(o)[0]; a.async = 1; a.src = g; m.parentNode.insertBefore(a, m)
        })(window, document, 'script', '//www.google-analytics.com/analytics.js', 'ga');

        ga('create', 'UA-50895981-1', 'evelinag.com');
        ga('send', 'pageview');

    </script>
    <!-- End Google Analytics -->
</head>


<body>
    <!-- Nav Bar -->
    <div class="row">
        <div class="medium-12 columns">

            <div class="logo">
                <a href="http://www.evelinag.com"><h1>Evelina Gabasova<apostrophe>'</apostrophe>s blog</h1></a>
            </div>

        </div>
    </div>
    <!-- End Nav -->
    <!-- Main Page Content and Sidebar -->
    <div class="row">
        <div class="large-10 medium-12 small-12 columns" role="content">
            
<h1>F# tackles James Bond</h1>
<article>
    
<div class="row">
<div class="medium-7 columns">

<p>Earlier this week I read an interesting article on visualizing box office success of 
James Bond films using R and ggplot2 by Christoph Safferling (
you can find it <a href="http://opiateforthemass.es/articles/james-bond-film-ratings/">here</a>).
The blog post shows how to pull information from Wikipedia and visualize 
the budget, box office and rating of each film - all this using R. 
While reading the blog post, I couldn't help wondering how would a similar 
analysis look in F# using the HTML type provider from the
<a href="http://fsharp.github.io/FSharp.Data/index.html">F# Data</a> library.</p>

</div>
<div class="medium-5 columns">

<p><img src="https://upload.wikimedia.org/wikipedia/en/1/19/007_logo.svg" alt="007 Logo" /></p>

</div>
</div>

<!-- more -->

<p>I was looking for a good excuse to play with the HTML type provider for some time so I decided
to replicate the analysis. And since I saw the 
latest James Bond film Spectre recently, I was also curious how do the individual films differ 
from each other quantitatively.</p>

<p>The original <a href="http://opiateforthemass.es/articles/james-bond-film-ratings/">blog post</a> 
looks at how does the box office success of each film compare to its aggregated rating from 
Rotten Tomatoes. All the data are available on Wikipedia in a single 
<a href="https://en.wikipedia.org/w/index.php?title=List_of_James_Bond_films&amp;oldid=688916363">article</a>, so 
all that is needed is to download the data, clean them and visualize them.</p>

<h2>Accessing data with HTML type provider</h2>

<p>To download the data from Wikipedia, the original blog post used <code>rvest</code> package in R. As I'm using
the HTML type provider in F# to do the same task, the first step is to use the URL of the article
to initialize the type provider. The type provider
then looks at the website and generates statically typed access to all the tables that appear on that website:</p>

<table class="pre"><tr><td class="lines"><pre class="fssnip">
<span class="l">1: </span>
<span class="l">2: </span>
<span class="l">3: </span>
<span class="l">4: </span>
<span class="l">5: </span>
<span class="l">6: </span>
<span class="l">7: </span>
<span class="l">8: </span>
</pre>
</td>
<td class="snippet"><pre class="fssnip">
<span class="prep">#load</span> <span class="s">&quot;</span><span class="s">packages</span><span class="s">/</span><span class="s">FsLab</span><span class="s">/</span><span class="s">FsLab</span><span class="s">.</span><span class="s">fsx</span><span class="s">&quot;</span>
<span class="k">open</span> <span class="i">FSharp</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs1', 1)" onmouseover="showTip(event, 'fs1', 1)" class="i">Data</span>
<span class="k">open</span> <span class="i">XPlot</span><span class="o">.</span><span class="i">GoogleCharts</span>

<span class="k">let</span> <span onmouseout="hideTip(event, 'fs2', 2)" onmouseover="showTip(event, 'fs2', 2)" class="i">bondUrl</span> <span class="o">=</span> <span class="s">&quot;</span><span class="s">https</span><span class="s">:</span><span class="s">/</span><span class="s">/</span><span class="s">en</span><span class="s">.</span><span class="s">wikipedia</span><span class="s">.</span><span class="s">org</span><span class="s">/</span><span class="s">w</span><span class="s">/</span><span class="s">index</span><span class="s">.</span><span class="s">php</span><span class="s">?</span><span class="s">title</span><span class="s">=</span><span class="s">List_of_James_Bond_films</span><span class="s">&amp;</span><span class="s">oldid</span><span class="s">=</span><span class="s">688916363</span><span class="s">&quot;</span>
<span class="k">type</span> <span onmouseout="hideTip(event, 'fs3', 3)" onmouseover="showTip(event, 'fs3', 3)" class="i">BondProvider</span> <span class="o">=</span> <span class="i">HtmlProvider</span><span class="o">&lt;</span><span id="fst4" onmouseout="hideTip(event, 'fs4', 4)" onmouseover="showTip(event, 'fs4', 4, document.getElementById('fst4'))" class="omitted">(...)</span><span class="o">&gt;</span>

<span class="k">let</span> <span onmouseout="hideTip(event, 'fs5', 5)" onmouseover="showTip(event, 'fs5', 5)" class="i">bondWiki</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs3', 6)" onmouseover="showTip(event, 'fs3', 6)" class="i">BondProvider</span><span class="o">.</span><span class="i">Load</span>(<span onmouseout="hideTip(event, 'fs2', 7)" onmouseover="showTip(event, 'fs2', 7)" class="i">bondUrl</span>) </pre>
</td>
</tr>
</table>

<p>Accessing the actual data from the Wikipedia article was so quick and easy that I had to create a gif to 
show explicitly how nice and straightforward it is:</p>

<p><img src="bondProvider.gif" alt="Bond type provider" /></p>

<p>One of the main advantages of the HTML type provider is that we can access the tables on the website using
their original headings. The original R version of the code accesses the tables using the
order in which the tables appear on the website so we would need to know the index of the correct table.</p>

<p>When accessing individual items in the table, we can similarly see all the labels from the table's header and 
directly access all the elements in each row. No need to parse or clean the data manually.</p>

<p>Using the type provider, I pulled the following information about each film: the title, year, the actor, the budget and 
the box office. Both the budet and the box office are adjusted to the equivalent of 2005 
prices to make them comparable between different years. 
Again, the type provider does most of the parsing, except for a few tweaks that the original Wikipedia 
table used to make alphabetic sorting of items in the table easier. Because of this, I had to manually 
adjust some of titles and names of the actors.</p>

<table class="pre"><tr><td class="lines"><pre class="fssnip">
<span class="l"> 1: </span>
<span class="l"> 2: </span>
<span class="l"> 3: </span>
<span class="l"> 4: </span>
<span class="l"> 5: </span>
<span class="l"> 6: </span>
<span class="l"> 7: </span>
<span class="l"> 8: </span>
<span class="l"> 9: </span>
<span class="l">10: </span>
<span class="l">11: </span>
<span class="l">12: </span>
<span class="l">13: </span>
</pre>
</td>
<td class="snippet"><pre class="fssnip">
<span class="k">let</span> <span onmouseout="hideTip(event, 'fs6', 8)" onmouseover="showTip(event, 'fs6', 8)" class="i">boxOffice</span> <span class="o">=</span> 
    <span class="k">let</span> <span onmouseout="hideTip(event, 'fs7', 9)" onmouseover="showTip(event, 'fs7', 9)" class="i">allBoxOffice</span> <span class="o">=</span> 
        [| <span class="k">for</span> <span onmouseout="hideTip(event, 'fs8', 10)" onmouseover="showTip(event, 'fs8', 10)" class="i">row</span> <span class="k">in</span> <span onmouseout="hideTip(event, 'fs5', 11)" onmouseover="showTip(event, 'fs5', 11)" class="i">bondWiki</span><span class="o">.</span><span class="i">Tables</span><span class="o">.</span><span class="i">``Box office``</span><span class="o">.</span><span class="i">Rows</span> <span class="k">-&gt;</span>
            <span onmouseout="hideTip(event, 'fs8', 12)" onmouseover="showTip(event, 'fs8', 12)" class="i">row</span><span class="o">.</span><span class="i">Title</span>, <span onmouseout="hideTip(event, 'fs8', 13)" onmouseover="showTip(event, 'fs8', 13)" class="i">row</span><span class="o">.</span><span class="i">Year</span>, <span onmouseout="hideTip(event, 'fs8', 14)" onmouseover="showTip(event, 'fs8', 14)" class="i">row</span><span class="o">.</span><span class="i">Budget2</span>, 
            <span onmouseout="hideTip(event, 'fs8', 15)" onmouseover="showTip(event, 'fs8', 15)" class="i">row</span><span class="o">.</span><span class="i">``Box office 2``</span>, <span onmouseout="hideTip(event, 'fs8', 16)" onmouseover="showTip(event, 'fs8', 16)" class="i">row</span><span class="o">.</span><span class="i">``Bond actor``</span> |]
    <span onmouseout="hideTip(event, 'fs7', 17)" onmouseover="showTip(event, 'fs7', 17)" class="i">allBoxOffice</span><span class="o">.</span>[<span class="n">1..</span><span onmouseout="hideTip(event, 'fs7', 18)" onmouseover="showTip(event, 'fs7', 18)" class="i">allBoxOffice</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs9', 19)" onmouseover="showTip(event, 'fs9', 19)" class="i">Length</span><span class="o">-</span><span class="n">3</span>]
    <span class="o">|&gt;</span> <span onmouseout="hideTip(event, 'fs10', 20)" onmouseover="showTip(event, 'fs10', 20)" class="i">Array</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs11', 21)" onmouseover="showTip(event, 'fs11', 21)" class="i">map</span> (<span class="k">fun</span> (<span onmouseout="hideTip(event, 'fs12', 22)" onmouseover="showTip(event, 'fs12', 22)" class="i">titleRaw</span>, <span onmouseout="hideTip(event, 'fs13', 23)" onmouseover="showTip(event, 'fs13', 23)" class="i">yr</span>, <span onmouseout="hideTip(event, 'fs14', 24)" onmouseover="showTip(event, 'fs14', 24)" class="i">bdgt</span>, <span onmouseout="hideTip(event, 'fs15', 25)" onmouseover="showTip(event, 'fs15', 25)" class="i">bo</span>, <span onmouseout="hideTip(event, 'fs16', 26)" onmouseover="showTip(event, 'fs16', 26)" class="i">actorRaw</span>) <span class="k">-&gt;</span> 
        <span class="k">let</span> <span onmouseout="hideTip(event, 'fs17', 27)" onmouseover="showTip(event, 'fs17', 27)" class="i">actor</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs16', 28)" onmouseover="showTip(event, 'fs16', 28)" class="i">actorRaw</span><span class="o">.</span>[<span onmouseout="hideTip(event, 'fs16', 29)" onmouseover="showTip(event, 'fs16', 29)" class="i">actorRaw</span><span class="o">.</span><span class="i">Length</span><span class="o">/</span><span class="n">2</span> <span class="o">+</span> <span class="n">1</span> <span class="o">..</span> ]
        <span class="k">let</span> <span onmouseout="hideTip(event, 'fs18', 30)" onmouseover="showTip(event, 'fs18', 30)" class="i">title</span> <span class="o">=</span> 
            <span class="k">match</span> <span onmouseout="hideTip(event, 'fs12', 31)" onmouseover="showTip(event, 'fs12', 31)" class="i">titleRaw</span> <span class="o">|&gt;</span> <span onmouseout="hideTip(event, 'fs19', 32)" onmouseover="showTip(event, 'fs19', 32)" class="i">Seq</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs20', 33)" onmouseover="showTip(event, 'fs20', 33)" class="i">tryFindIndex</span> ((<span class="o">=</span>) <span class="s">&#39;!&#39;</span>) <span class="k">with</span>
            | <span onmouseout="hideTip(event, 'fs21', 34)" onmouseover="showTip(event, 'fs21', 34)" class="i">Some</span>(<span onmouseout="hideTip(event, 'fs22', 35)" onmouseover="showTip(event, 'fs22', 35)" class="i">idx</span>) <span class="k">-&gt;</span> <span onmouseout="hideTip(event, 'fs12', 36)" onmouseover="showTip(event, 'fs12', 36)" class="i">titleRaw</span><span class="o">.</span>[<span onmouseout="hideTip(event, 'fs22', 37)" onmouseover="showTip(event, 'fs22', 37)" class="i">idx</span><span class="o">+</span><span class="n">1</span> <span class="o">..</span>]
            | <span onmouseout="hideTip(event, 'fs23', 38)" onmouseover="showTip(event, 'fs23', 38)" class="i">None</span> <span class="k">-&gt;</span> <span onmouseout="hideTip(event, 'fs12', 39)" onmouseover="showTip(event, 'fs12', 39)" class="i">titleRaw</span>
        <span onmouseout="hideTip(event, 'fs18', 40)" onmouseover="showTip(event, 'fs18', 40)" class="i">title</span>, <span onmouseout="hideTip(event, 'fs24', 41)" onmouseover="showTip(event, 'fs24', 41)" class="i">int</span> <span onmouseout="hideTip(event, 'fs13', 42)" onmouseover="showTip(event, 'fs13', 42)" class="i">yr</span>, <span onmouseout="hideTip(event, 'fs25', 43)" onmouseover="showTip(event, 'fs25', 43)" class="i">float</span> <span onmouseout="hideTip(event, 'fs14', 44)" onmouseover="showTip(event, 'fs14', 44)" class="i">bdgt</span>, <span onmouseout="hideTip(event, 'fs25', 45)" onmouseover="showTip(event, 'fs25', 45)" class="i">float</span> <span onmouseout="hideTip(event, 'fs15', 46)" onmouseover="showTip(event, 'fs15', 46)" class="i">bo</span>, <span onmouseout="hideTip(event, 'fs17', 47)" onmouseover="showTip(event, 'fs17', 47)" class="i">actor</span>)</pre>
</td>
</tr>
</table>

<p>To keep things simple, I returned all the values as a simple array of tuples containing all the relevant 
information. This could be modified to a proper data frame using <a href="http://bluemountaincapital.github.io/Deedle/">Deedle</a>.</p>

<p>As the next step, I downloaded the Rotten tomatoes ratings, which are placed in a different table called 
"Reception and accolades" on the same Wikipedia page:</p>

<table class="pre"><tr><td class="lines"><pre class="fssnip">
<span class="l">1: </span>
<span class="l">2: </span>
<span class="l">3: </span>
<span class="l">4: </span>
<span class="l">5: </span>
<span class="l">6: </span>
<span class="l">7: </span>
</pre>
</td>
<td class="snippet"><pre class="fssnip">
<span class="k">let</span> <span onmouseout="hideTip(event, 'fs26', 48)" onmouseover="showTip(event, 'fs26', 48)" class="i">rating</span> <span class="o">=</span> 
    <span class="k">let</span> <span onmouseout="hideTip(event, 'fs27', 49)" onmouseover="showTip(event, 'fs27', 49)" class="i">allRatings</span> <span class="o">=</span> 
        [| <span class="k">for</span> <span onmouseout="hideTip(event, 'fs8', 50)" onmouseover="showTip(event, 'fs8', 50)" class="i">row</span> <span class="k">in</span> <span onmouseout="hideTip(event, 'fs5', 51)" onmouseover="showTip(event, 'fs5', 51)" class="i">bondWiki</span><span class="o">.</span><span class="i">Tables</span><span class="o">.</span><span class="i">``Reception and accolades``</span><span class="o">.</span><span class="i">Rows</span> <span class="k">-&gt;</span>
            <span onmouseout="hideTip(event, 'fs8', 52)" onmouseover="showTip(event, 'fs8', 52)" class="i">row</span><span class="o">.</span><span class="i">Film</span>, <span onmouseout="hideTip(event, 'fs8', 53)" onmouseover="showTip(event, 'fs8', 53)" class="i">row</span><span class="o">.</span><span class="i">``Rotten Tomatoes``</span> |]
    <span onmouseout="hideTip(event, 'fs27', 54)" onmouseover="showTip(event, 'fs27', 54)" class="i">allRatings</span><span class="o">.</span>[<span class="n">0..</span><span onmouseout="hideTip(event, 'fs27', 55)" onmouseover="showTip(event, 'fs27', 55)" class="i">allRatings</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs9', 56)" onmouseover="showTip(event, 'fs9', 56)" class="i">Length</span><span class="o">-</span><span class="n">2</span>]
    <span class="o">|&gt;</span> <span onmouseout="hideTip(event, 'fs10', 57)" onmouseover="showTip(event, 'fs10', 57)" class="i">Array</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs11', 58)" onmouseover="showTip(event, 'fs11', 58)" class="i">map</span> (<span class="k">fun</span> (<span onmouseout="hideTip(event, 'fs28', 59)" onmouseover="showTip(event, 'fs28', 59)" class="i">title</span>, <span onmouseout="hideTip(event, 'fs29', 60)" onmouseover="showTip(event, 'fs29', 60)" class="i">r</span>) <span class="k">-&gt;</span> 
        <span onmouseout="hideTip(event, 'fs28', 61)" onmouseover="showTip(event, 'fs28', 61)" class="i">title</span>, <span onmouseout="hideTip(event, 'fs29', 62)" onmouseover="showTip(event, 'fs29', 62)" class="i">r</span><span class="o">.</span>[<span class="n">0..</span><span onmouseout="hideTip(event, 'fs29', 63)" onmouseover="showTip(event, 'fs29', 63)" class="i">r</span><span class="o">.</span><span class="i">IndexOf</span>(<span class="s">&#39;%&#39;</span>)<span class="o">-</span><span class="n">1</span>] <span class="o">|&gt;</span> <span onmouseout="hideTip(event, 'fs25', 64)" onmouseover="showTip(event, 'fs25', 64)" class="i">float</span> )</pre>
</td>
</tr>
</table>

<p>Here I had to strip off some additional information like the percent sign and the total number
of reviews that Wikipedia added into each cell of the table.</p>

<h2>Visualization</h2>

<p>Now we are ready to do some charting. I'm using the <a href="https://tahahachana.github.io/XPlot/">XPlot</a> library 
which provides a nice API for Google Charts (and also plot.ly). To follow the visualization used in the original
blog post, I decided to create a bubble chart. This type of plot in Google Charts 
takes up to four parameters for each data point:
to define its horizontal and vertical position in the plot, and to specify the colour and size of each bubble.</p>

<table class="pre"><tr><td class="lines"><pre class="fssnip">
<span class="l"> 1: </span>
<span class="l"> 2: </span>
<span class="l"> 3: </span>
<span class="l"> 4: </span>
<span class="l"> 5: </span>
<span class="l"> 6: </span>
<span class="l"> 7: </span>
<span class="l"> 8: </span>
<span class="l"> 9: </span>
<span class="l">10: </span>
<span class="l">11: </span>
<span class="l">12: </span>
<span class="l">13: </span>
</pre>
</td>
<td class="snippet"><pre class="fssnip">
<span class="k">let</span> <span onmouseout="hideTip(event, 'fs30', 65)" onmouseover="showTip(event, 'fs30', 65)" class="i">options</span> <span class="o">=</span>
    <span class="i">Options</span>(
        <span class="i">title</span> <span class="o">=</span> <span class="s">&quot;</span><span class="s">Bond</span><span class="s"> </span><span class="s">fims</span><span class="s"> </span><span class="s">-</span><span class="s"> </span><span class="s">rating</span><span class="s"> </span><span class="s">and</span><span class="s"> </span><span class="s">box</span><span class="s"> </span><span class="s">office</span><span class="s">&quot;</span>,
        <span class="i">hAxis</span> <span class="o">=</span> <span class="i">Axis</span>(<span class="i">title</span> <span class="o">=</span> <span class="s">&quot;</span><span class="s">Year</span><span class="s">&quot;</span>),
        <span class="i">vAxis</span> <span class="o">=</span> <span class="i">Axis</span>(<span class="i">title</span> <span class="o">=</span> <span class="s">&quot;</span><span class="s">Box</span><span class="s"> </span><span class="s">office</span><span class="s"> </span><span class="s">(</span><span class="s">millions</span><span class="s"> </span><span class="s">$</span><span class="s">)</span><span class="s">&quot;</span>),
        <span class="i">bubble</span> <span class="o">=</span> <span class="i">Bubble</span>(<span class="i">textStyle</span><span class="o">=</span><span class="i">TextStyle</span>(<span class="i">color</span><span class="o">=</span><span class="s">&quot;</span><span class="s">transparent</span><span class="s">&quot;</span>)),
        <span class="i">colors</span> <span class="o">=</span> [| <span class="s">&quot;</span><span class="s">red</span><span class="s">&quot;</span>; <span class="s">&quot;</span><span class="s">gold</span><span class="s">&quot;</span> |] )

<span onmouseout="hideTip(event, 'fs10', 66)" onmouseover="showTip(event, 'fs10', 66)" class="i">Array</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs31', 67)" onmouseover="showTip(event, 'fs31', 67)" class="i">map2</span> (<span class="k">fun</span> (<span onmouseout="hideTip(event, 'fs18', 68)" onmouseover="showTip(event, 'fs18', 68)" class="i">title</span>, <span onmouseout="hideTip(event, 'fs13', 69)" onmouseover="showTip(event, 'fs13', 69)" class="i">yr</span>, <span onmouseout="hideTip(event, 'fs32', 70)" onmouseover="showTip(event, 'fs32', 70)" class="i">bdgt</span>, <span onmouseout="hideTip(event, 'fs33', 71)" onmouseover="showTip(event, 'fs33', 71)" class="i">bo</span>, <span onmouseout="hideTip(event, 'fs17', 72)" onmouseover="showTip(event, 'fs17', 72)" class="i">actor</span>) (_, <span onmouseout="hideTip(event, 'fs34', 73)" onmouseover="showTip(event, 'fs34', 73)" class="i">rt</span>) <span class="k">-&gt;</span> 
                <span onmouseout="hideTip(event, 'fs18', 74)" onmouseover="showTip(event, 'fs18', 74)" class="i">title</span> <span class="o">+</span> <span class="s">&quot;</span><span class="s"> </span><span class="s">(</span><span class="s">&quot;</span> <span class="o">+</span> <span onmouseout="hideTip(event, 'fs17', 75)" onmouseover="showTip(event, 'fs17', 75)" class="i">actor</span> <span class="o">+</span> <span class="s">&quot;</span><span class="s">)</span><span class="s">&quot;</span>, <span onmouseout="hideTip(event, 'fs13', 76)" onmouseover="showTip(event, 'fs13', 76)" class="i">yr</span>, <span onmouseout="hideTip(event, 'fs33', 77)" onmouseover="showTip(event, 'fs33', 77)" class="i">bo</span>, <span onmouseout="hideTip(event, 'fs34', 78)" onmouseover="showTip(event, 'fs34', 78)" class="i">rt</span>, <span onmouseout="hideTip(event, 'fs32', 79)" onmouseover="showTip(event, 'fs32', 79)" class="i">bdgt</span> ) <span onmouseout="hideTip(event, 'fs6', 80)" onmouseover="showTip(event, 'fs6', 80)" class="i">boxOffice</span> <span onmouseout="hideTip(event, 'fs26', 81)" onmouseover="showTip(event, 'fs26', 81)" class="i">rating</span>
<span class="o">|&gt;</span> <span class="i">Chart</span><span class="o">.</span><span class="i">Bubble</span>
<span class="o">|&gt;</span> <span class="i">Chart</span><span class="o">.</span><span class="i">WithLabels</span>([<span class="s">&quot;</span><span class="s">Title</span><span class="s">&quot;</span>; <span class="s">&quot;</span><span class="s">Year</span><span class="s">&quot;</span>; <span class="s">&quot;</span><span class="s">Box</span><span class="s"> </span><span class="s">office</span><span class="s">&quot;</span>; <span class="s">&quot;</span><span class="s">Rating</span><span class="s">&quot;</span>; <span class="s">&quot;</span><span class="s">Budget</span><span class="s">&quot;</span>])
<span class="o">|&gt;</span> <span class="i">Chart</span><span class="o">.</span><span class="i">WithOptions</span>(<span onmouseout="hideTip(event, 'fs30', 82)" onmouseover="showTip(event, 'fs30', 82)" class="i">options</span>)</pre>
</td>
</tr>
</table>

<script type="text/javascript" src="https://www.google.com/jsapi"></script>
<script type="text/javascript">
    google.load("visualization", "1", {packages:["corechart"]})
    google.setOnLoadCallback(drawChart);
function drawChart() {
    var data = new google.visualization.DataTable({"cols": [{"type": "string" ,"id": "Title" ,"label": "Title" }, {"type": "number" ,"id": "Year" ,"label": "Year" }, {"type": "number" ,"id": "Box office" ,"label": "Box office" }, {"type": "number" ,"id": "Rating" ,"label": "Rating" }, {"type": "number" ,"id": "Budget" ,"label": "Budget" }], "rows" : [{"c" : [{"v": "Dr. No (Sean Connery)"}, {"v": 1962}, {"v": 448.8}, {"v": 96}, {"v": 7}]}, {"c" : [{"v": "From Russia with Love (Sean Connery)"}, {"v": 1963}, {"v": 543.8}, {"v": 96}, {"v": 12.6}]}, {"c" : [{"v": "Goldfinger (Sean Connery)"}, {"v": 1964}, {"v": 820.4}, {"v": 96}, {"v": 18.6}]}, {"c" : [{"v": "Thunderball (Sean Connery)"}, {"v": 1965}, {"v": 848.1}, {"v": 86}, {"v": 41.9}]}, {"c" : [{"v": "You Only Live Twice (Sean Connery)"}, {"v": 1967}, {"v": 514.2}, {"v": 72}, {"v": 59.9}]}, {"c" : [{"v": "On Her Majesty's Secret Service (George Lazenby)"}, {"v": 1969}, {"v": 291.5}, {"v": 82}, {"v": 37.3}]}, {"c" : [{"v": "Diamonds Are Forever (Sean Connery)"}, {"v": 1971}, {"v": 442.5}, {"v": 67}, {"v": 34.7}]}, {"c" : [{"v": "Live and Let Die (Roger Moore)"}, {"v": 1973}, {"v": 460.3}, {"v": 66}, {"v": 30.8}]}, {"c" : [{"v": "The Man with the Golden Gun (Roger Moore)"}, {"v": 1974}, {"v": 334}, {"v": 46}, {"v": 27.7}]}, {"c" : [{"v": "The Spy Who Loved Me (Roger Moore)"}, {"v": 1977}, {"v": 533}, {"v": 79}, {"v": 45.1}]}, {"c" : [{"v": "Moonraker (Roger Moore)"}, {"v": 1979}, {"v": 535}, {"v": 60}, {"v": 91.5}]}, {"c" : [{"v": "For Your Eyes Only (Roger Moore)"}, {"v": 1981}, {"v": 449.4}, {"v": 74}, {"v": 60.2}]}, {"c" : [{"v": "Octopussy (Roger Moore)"}, {"v": 1983}, {"v": 373.8}, {"v": 42}, {"v": 53.9}]}, {"c" : [{"v": "A View to a Kill (Roger Moore)"}, {"v": 1985}, {"v": 275.2}, {"v": 35}, {"v": 54.5}]}, {"c" : [{"v": "The Living Daylights (Timothy Dalton)"}, {"v": 1987}, {"v": 313.5}, {"v": 69}, {"v": 68.8}]}, {"c" : [{"v": "Licence to Kill (Timothy Dalton)"}, {"v": 1989}, {"v": 250.9}, {"v": 76}, {"v": 56.7}]}, {"c" : [{"v": "GoldenEye (Pierce Brosnan)"}, {"v": 1995}, {"v": 518.5}, {"v": 77}, {"v": 76.9}]}, {"c" : [{"v": "Tomorrow Never Dies (Pierce Brosnan)"}, {"v": 1997}, {"v": 463.2}, {"v": 57}, {"v": 133.9}]}, {"c" : [{"v": "The World Is Not Enough (Pierce Brosnan)"}, {"v": 1999}, {"v": 439.5}, {"v": 51}, {"v": 158.3}]}, {"c" : [{"v": "Die Another Day (Pierce Brosnan)"}, {"v": 2002}, {"v": 465.4}, {"v": 58}, {"v": 154.2}]}, {"c" : [{"v": "Casino Royale (Daniel Craig)"}, {"v": 2006}, {"v": 581.5}, {"v": 95}, {"v": 145.3}]}, {"c" : [{"v": "Quantum of Solace (Daniel Craig)"}, {"v": 2008}, {"v": 514.2}, {"v": 65}, {"v": 181.4}]}, {"c" : [{"v": "Skyfall (Daniel Craig)"}, {"v": 2012}, {"v": 879.8}, {"v": 93}, {"v": 158.1}]}]});
    var options = {"colors":["red","gold"],"hAxis":{"title":"Year"},"legend":{"position":"none"},"title":"Bond fims - rating and box office","vAxis":{"title":"Box office (millions $)"},"bubble":{"textStyle":{"color":"transparent"}}} 
    var chart = new google.visualization.BubbleChart(document.getElementById('7079c2e6-91fe-4ff3-96c1-f778b22874df'));
    chart.draw(data, options);
}
</script>

<div id="7079c2e6-91fe-4ff3-96c1-f778b22874df" style="width: 100%; height: 500px;"></div>

<p>In the resulting plot, the x axis represents the year and the y axis shows the box office success. 
The size of each bubble represents the budget of each film, and finally the colours show the Rotten Tomatoes
rating where lighter colours mean higher rating. Also, hover over the individual bubbles to see all the 
information about the films including their title and the James Bond actors.</p>

<p>This plot shows that the first few James Bond films with Sean Connery were very successfull, 
with small budgets, high aggregated rating and growing revenues. The revenue was gradually decreasing
over the Roger Moore and Timothy Dalton era. The box office again improved after 1995 with Pierce
Brosnan, and the budgets increased as well. Two of the most recent films with Daniel Craig, Casino
Royal and Skyfall, also reached similarly high aggregated ratings as some of the older Sean Connery films. 
Unfortunately, there are no available data on Spectre at the moment so we don't know how does it
compare to the previous films.</p>

<p>From the source code perspective, this all took about 45 lines of F# code, 
compared to 125 lines of R code that were used in the original blog 
post to produce a similar bubble chart with ggplot2 
(<a href="https://github.com/safferli/james_bond_films/blob/master/007.R">see the original R code</a>). 
The difference in 
size is mainly because the R code parses all the data in the Wikipedia table manually to create a 
clean data frame. In F#, the HTML type provider already does most of the work that is required to get
the data into a usable shape.</p>

<p>I also tried to replicate the resulting ggplot figure from the original blog post to test the capabilities 
of the F# <a href="http://bluemountaincapital.github.io/FSharpRProvider/">RPRovider</a>, which is a mechanism of 
accessing functions from R within F#. Using ggplot2 from F# with RProvider is a little more verbose than in 
R, but the full F# code still came out shorter than the the full R code (125 lines in F# compared to 187 lines in R). 
The code I used to generate the bubble chart and the full ggplot2 chart is available as a 
<a href="https://gist.github.com/evelinag/0ce68655f2aae1ecabcb">gist</a>.</p>

<p><img src="bond-ggplot.png" alt="James Bond with ggplot" /></p>

<h2>Summary</h2>

<p>Overall, I was very happy with the whole F# HTML type provider experience. It allows accessing most of the
elements from the webpage using their real human-readable names and it does a great job parsing the data from 
the tables. Compared to the R version, there is less work left to be done to get the data into a good
shape and prepare it for visualisation.</p>

<p>Finally, here is the source code that I used and some other relevant links:</p>

<ul>
<li><a href="https://gist.github.com/evelinag/0ce68655f2aae1ecabcb">Source code</a></li>
<li>This blog post uses FsLab, you can download a template <a href="http://fslab.org/download/">here</a></li>
<li><a href="http://opiateforthemass.es/articles/james-bond-film-ratings/">Blog post that inspired all this</a></li>
</ul>

<div class="tip" id="fs1">namespace Microsoft.FSharp.Data</div>
<div class="tip" id="fs2">val bondUrl : string<br /><br />Full name: ftacklesjamesbond.bondUrl</div>
<div class="tip" id="fs3">type BondProvider = obj<br /><br />Full name: ftacklesjamesbond.BondProvider</div>
<div class="tip" id="fs4">&quot;https://en.wikipedia.org/w/index.php?title=List_of_James_Bond_films&amp;oldid=688916363&quot;</div>
<div class="tip" id="fs5">val bondWiki : obj<br /><br />Full name: ftacklesjamesbond.bondWiki</div>
<div class="tip" id="fs6">val boxOffice : (string * int * float * float * string) []<br /><br />Full name: ftacklesjamesbond.boxOffice</div>
<div class="tip" id="fs7">val allBoxOffice : (string * int * int * int * obj) []</div>
<div class="tip" id="fs8">val row : obj</div>
<div class="tip" id="fs9">property System.Array.Length: int</div>
<div class="tip" id="fs10">module Array<br /><br />from Microsoft.FSharp.Collections</div>
<div class="tip" id="fs11">val map : mapping:(&#39;T -&gt; &#39;U) -&gt; array:&#39;T [] -&gt; &#39;U []<br /><br />Full name: Microsoft.FSharp.Collections.Array.map</div>
<div class="tip" id="fs12">val titleRaw : string</div>
<div class="tip" id="fs13">val yr : int</div>
<div class="tip" id="fs14">val bdgt : int</div>
<div class="tip" id="fs15">val bo : int</div>
<div class="tip" id="fs16">val actorRaw : obj</div>
<div class="tip" id="fs17">val actor : string</div>
<div class="tip" id="fs18">val title : string</div>
<div class="tip" id="fs19">module Seq<br /><br />from Microsoft.FSharp.Collections</div>
<div class="tip" id="fs20">val tryFindIndex : predicate:(&#39;T -&gt; bool) -&gt; source:seq&lt;&#39;T&gt; -&gt; int option<br /><br />Full name: Microsoft.FSharp.Collections.Seq.tryFindIndex</div>
<div class="tip" id="fs21">union case Option.Some: Value: &#39;T -&gt; Option&lt;&#39;T&gt;</div>
<div class="tip" id="fs22">val idx : int</div>
<div class="tip" id="fs23">union case Option.None: Option&lt;&#39;T&gt;</div>
<div class="tip" id="fs24">Multiple items<br />val int : value:&#39;T -&gt; int (requires member op_Explicit)<br /><br />Full name: Microsoft.FSharp.Core.Operators.int<br /><br />--------------------<br />type int = int32<br /><br />Full name: Microsoft.FSharp.Core.int<br /><br />--------------------<br />type int&lt;&#39;Measure&gt; = int<br /><br />Full name: Microsoft.FSharp.Core.int&lt;_&gt;</div>
<div class="tip" id="fs25">Multiple items<br />val float : value:&#39;T -&gt; float (requires member op_Explicit)<br /><br />Full name: Microsoft.FSharp.Core.Operators.float<br /><br />--------------------<br />type float = System.Double<br /><br />Full name: Microsoft.FSharp.Core.float<br /><br />--------------------<br />type float&lt;&#39;Measure&gt; = float<br /><br />Full name: Microsoft.FSharp.Core.float&lt;_&gt;</div>
<div class="tip" id="fs26">val rating : (obj * float) []<br /><br />Full name: ftacklesjamesbond.rating</div>
<div class="tip" id="fs27">val allRatings : (obj * obj) []</div>
<div class="tip" id="fs28">val title : obj</div>
<div class="tip" id="fs29">val r : obj</div>
<div class="tip" id="fs30">val options : obj<br /><br />Full name: ftacklesjamesbond.options</div>
<div class="tip" id="fs31">val map2 : mapping:(&#39;T1 -&gt; &#39;T2 -&gt; &#39;U) -&gt; array1:&#39;T1 [] -&gt; array2:&#39;T2 [] -&gt; &#39;U []<br /><br />Full name: Microsoft.FSharp.Collections.Array.map2</div>
<div class="tip" id="fs32">val bdgt : float</div>
<div class="tip" id="fs33">val bo : float</div>
<div class="tip" id="fs34">val rt : float</div>

</article>

<p class="post-meta">
    Published on Wednesday, 18 November 2015
    <br />
    By <a href="https://plus.google.com/+EvelinaGabasova?rel=author">Evelina Gabasova</a><br />
</p>

<!-- AddThis Button BEGIN -->
<div class="addthis_toolbox addthis_default_style addthis_32x32_style">
    <a class="addthis_button_twitter"></a>
    <a class="addthis_button_reddit"></a>
    <a class="addthis_button_google_plusone_share"></a>
    <a class="addthis_button_facebook"></a>
    <a class="addthis_button_compact"></a><a class="addthis_counter addthis_bubble_style"></a>
</div>
<br />

<script type="text/javascript">var addthis_config = { "data_track_addressbar": true };</script>
<script type="text/javascript" src="//s7.addthis.com/js/300/addthis_widget.js#pubid=ra-531bbb5c0879f9d7"></script>
<!-- AddThis Button END -->

<!-- Disqus -->
<div id="disqus_thread"></div>
<script type="text/javascript">
    /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
    var disqus_shortname = 'evelinag'; 
    var disqus_title = 'F# tackles James Bond';
    var disqus_url = 'http://evelinag.com/blog/2015/11-18-f-tackles-james-bond/index.html';

    /* * * DON'T EDIT BELOW THIS LINE * * */
    (function () {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="http://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
<!-- Disqus END -->

        </div>
    </div>
    <!-- End Main Content and Sidebar -->
    <!-- Footer -->
    <footer class="footer">
        <div class="row full-width">
            <div class="small-12 medium-6 large-8 columns">
                <i class="fi-laptop"></i>
                <h4>About</h4>
                <p>
                    You can find more about me at
                    <a href="http://evelinag.com/about/index.html">my professional web page</a>.
                    It includes details on my
                    <a href="http://evelinag.com/about/index.html#publications">academic research</a>
                    and
                    <a href="http://evelinag.com/about/index.html#talks">talks</a> that I gave.
                    There is a list of
                    <a href="http://evelinag.com/about/index.html#fsharptalks">my F# talks</a>,
                    which contains several recordings that you can watch.
                    See also a list of
                    <a href="http://evelinag.com/about/index.html#projects">projects</a>
                    that I am involved in.
                </p>
                <p>
                    This site is generated using <a href="https://github.com/fsprojects/FsBlog">FsBlog</a> and hosted on <a href="http://github.com/evelinag">GitHub</a>.
                    <br />By <a href="https://plus.google.com/+EvelinaGabasova?rel=author">Evelina Gabasova</a>, 2015
                </p>
            </div>
            <div class="small-12 medium-6 large-4 columns">
                <h4 class="footer-links">Contact information</h4>
                <ul class="footer-links">
                    <li>Twitter: <a href="http://twitter.com/evelgab">@evelgab</a></li>
                    <li>Email: <a href="mailto:evelina@evelinag.com">evelina@evelinag.com</a></li>
                    <li>Github: <a href="http://github.com/evelinag">evelinag</a></li>
                    <li>LinkedIn: <a href="http://uk.linkedin.com/in/egabasova">egabasova</a></li>
                    <li>My talks on <a href="http://lanyrd.com/profile/evelgab/">Lanyrd</a></li>
                    <li>Subscribe to my <a href="http://evelinag.com/rss.xml">blog</a></li>
                </ul>
            </div>
        </div>
    </footer>


    <!-- End Footer -->
    <!-- Foundation scripts -->
    <script src="http://evelinag.com/javascripts/vendor/jquery.js"></script>
    <script src="http://evelinag.com/javascripts/foundation.min.js"></script>
    <script src="http://evelinag.com/javascripts/foundation/foundation.interchange.js"></script>
    <script>
        $(document).foundation();
    </script>
    <!-- End Foundation scripts -->

</body>

</htm>
